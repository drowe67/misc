\documentclass{article}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{tikz}
\begin{document}

\title{Electro Magnetic Interference and HF Radio Receivers}
\maketitle

\section{Introduction}
 
Throughout the 20th century HF radio receiver technology evolved with the aim of detecting distant, narrow band signals.  Radio noise sets the limits of detection \cite{itu372}, and was assumed to be from natural sources or the receiver itself. However in the early 21st century, from lower HF right up to UHF noise from human activity now dominates the detection problem.  We are no longer seeking to maximise signal-to-noise ratio (SNR), but signal to EMI ratio (SER).

We are slowly losing the ability to use analog SSB in urban areas.  Many Hams report S9 noise levels, $9 \times 6 = 54$ dB Hams higher than a quiet S0 country station.  Consequently, digital modes that can operate operate at low SERs are becoming popular.  Digital modes are in an arms race with EMI.

Our target radio signals are from distant sources, weak, narrow band, and evolve slowly in time. Human generated radio noise tends to be very strong, wideband, with a time domain envelope that evolves quickly in time.  It is often radiated from nearby sources, such as power lines lines and house wiring a few 10s of meters from our antenna.  It has significant structure, so can be interpreted as an interfering signal, rather than random noise.

Modern radios are very good at rejecting strong unwanted narrowband signals, using frequency selectivity and good strong signal performance.  This report explores ways we can reject human made noise in the lower HF bands.

\section{Radio Noise Signals from Human Activity}

Table \ref{table:human_noise} is a summary of human generated noise sources.  The values are approximate and based on the authors experience - your mileage may vary!  This categorisation gives us some insight that can be used to classify signals, consider their impact, and possible attacks.

The Time and Frequency columns describes the distribution of energy in time and frequency, for example power line arcing can cause clicks in our radio similar to atmospheric lightning.  The noise signal consists of short, powerful time domain pulses that are randomly distributed in time, resulting in wideband energy uniformly distributed in frequency. It may be identified and removed via noise blanking techniques.

In contrast DSL signals radiated from leaky phone lines looks like noise in the time domain and frequency domain, making it particularity hard to identify and remove.  It is very similar to AWGN from natural noise sources.

Bandwidth relates the rate $R$ of the noise pulses to the bandwidth $B$ of a typical SSB HF receiver (around 3000 Hz).  When $R<<B$, we tend to hear individual noise pulses, and separate pulses can be observed in a time domain plot of the receiver output waveform.  When $R>B$, we hear just a bandpass segment of the EMI signal, for example a tone from a PWM harmonic, or some modulated wideband noise.

Our narrow band receiver smooths the time domain envelope. As $R$ relative to $B$ increase, our receiver converts a series of short time domain pulses (such as a PWM waveform) into a longer pulses with a smooth time domain envelope (AWGN noise), making the EMI signal harder to identify and remove.

If we position our receiver some distance from many urban noise signals (for example the middle of an urban park), we get the sum of many signals added together, which converges to AWGN noise.  The level reduces with distance, so an effective attack is decamping to a country location, and operating a portable station for the day.

For an EMI signal to be transmitted, we need a source of AC current and an antenna. Domestic electricity lines appear to operate in a mode part way between transmission line and antenna.  RF does seem to propagate along them quite well, they then radiate quiet strong signals to nearby homes.  Likewise, DSL signals on ancient phone lines are poor transmission lines and and reasonably effective antennas, radiating significant local EMI. A home with buried electricity lines and fibre or wireless supplying Internet is desirable.

\begin{table}[h]
\centering
\begin{tabular}{l l l l l l}
 \hline
 Name & Rate & Time & Frequency & Antenna & BW \\
 \hline
 Power Line & 1 Hz & random pulse & uniform & power lines & $R < B$ \\
 Downlights & 50-60 Hz & pulse train & harmonics & house wiring & $R < B$ \\
 SMPS & 10-300 kHz & pulse train & harmonics & house wiring & $R > B$ \\
 DSL & 1-12 MHz & AWGN & AWGN & phone lines & $R > B$ \\
 Urban Sum & lower HF & AWGN & AWGN & power lines & $R > B$ \\
 \hline
\end{tabular}
\caption{Summary of Radio signals from Human Activity}
\label{table:human_noise}
\end{table}

The modulation used in our desired target signals is a factor.  Digital modes can operate at lower SNRs than analog SSB.  Digital modes can also use Forward Error Correction (FEC), for example we can correct a bit error caused by a noise impulse wiping out one bit.  Digital modulation also has a threshold effect - once the interference is a few dB lower than the wanted signals, it's impact on bit errors is small. FM, FSK \& PSK are more robust to impulsive noise than amplitude modulated modes like SSB.

\section{Pulse Width Modulation}
\label{pwm}

The PWM switch mode power supply is a ubiquitous source of interference.  Consider the Fourier Series of an ideal pulse train \cite{wikipedia_pulse}:
\begin{equation} \label{eq_pwm}
\begin{split}
x(t) &= Ad+\frac{2A}{\pi} \sum_{n=1}^{\infty} \frac{sin(\pi n d)}{n}cos(n \omega t) \\
     &= Ad+\frac{2A}{\pi} \sum_{n=1}^{\infty} \frac{x(t)}{n} cos(n \omega t)
\end{split}
\end{equation}
where $0<d<1$ is the duty cycle and $\omega=2 \pi f$ the fundamental frequency.  The Fourier series is a sequence of harmonics $cos(n \omega t)$, with the amplitude of each harmonic set by the $x(t)/n$ term. A typical value for $f$ is a few 10's of kHz to several hundred kHz. For example with f = 70kHz and $n=101$ we will have a harmonic at 7.1 MHz. The $1/n$ factor means the power of each harmonic falls off slowly with frequency, e.g. the $n=100$ harmonic will be just $10log_{10}(1/100)=-20$ dB down compared to the fundamental ($n=1$) power, and the $n=101$ harmonic almost the same power at $10log_{10}(1/101)=-20.043$ dB down.

If the duty cycle $d$ is constant, then each harmonic is an unmodulated sine wave of constant amplitude. In practice $d$ is time varying, as the duty cycle is continuously adjusted by the power supply.  This leads to modulation of each harmonic $x(t)$, spreading the power to frequencies either side of the harmonic centre $n \omega$.

Let $d$ have a constant and time varying component:
\begin{equation}
d=d_c+ad(t)
\end{equation}
where $d(t)$, $|d(t)| \le 1$ is a PWM modulation function and $a$ is the peak amplitude of the modulation (ie the peak jitter of the PWM signal). For the $n$-th harmonic:
\begin{equation} \label{eq:pwm_n}
\begin{split}
x_n(t) &= sin(\pi n d) \\
       &= sin(\pi n (d_c+ad(t)) \\
       &= sin(\pi n d_c + \pi n a d(t)) \\
       &= sin(\pi n d_c + h d(t))  \\
     h &= \pi n a
\end{split}
\end{equation}
It can be seen that $h$ is strong function of $a$, as small changes are multiplied by $n \pi$. For example for $n=100, a=0.01, h = \pi$.  Thus with just 1\% jitter of the PWM signal, a cycle of $d(t)$ would modulate over the entire $\pm \pi$ range of the $sin()$ function.

We would like to estimate the spectrum of $x(t)$. First we consider small $h << 1$:
\begin{equation} \label{eq:small_h}
\begin{split}
x_n(t) &= sin(\pi n d_c)cos(hd(t)) + cos(\pi n d_c)sin(hd(t)) \\
       &\approx sin(\pi n d_c)(1 - (hd(t))^2/2) + cos(\pi n d_c)hd(t) \\
       &\approx sin(\pi n d_c) + hcos(\pi n d_c)d(t)
\end{split}
\end{equation}
The LHS is a constant term related to the mean duty cycle of the PWM signal, the RHS is linear modulation term, i.e. a small linear modulation about a mean set point.  When multiplied by the $n$-th harmonic $cos(n \omega t)$ in (\ref{eq_pwm}):
\begin{equation} \label{eq:small_h}
\begin{split}
x_n(t)cos(n \omega t) &= \left[ sin(\pi n d_c) + hcos(\pi n d_c)d(t) \right] cos(n \omega t) \\
                      &= sin(\pi n d_c)cos(n \omega t)) + hcos(\pi n d_c)d(t)cos(n \omega t) \\
                      &= c_1 cos(n \omega t)) + c_2 d(t)cos(n \omega t) \\
                   c_1 &= sin(\pi n d_c) \\
                   c_2 &= hcos(\pi n d_c)
\end{split}
\end{equation}
By examining the different frequency terms we can estimate the spectrum of the PWM signal near the n-th harmonic. Note $c_1$ and $c_2$ are constants that do not affect the number of different frequency terms. The LHS of (\ref{eq:small_h}) is a constant carrier term at the harmonic centre. The product of $d(t)cos(n \omega t))$ will produce images of the spectra of d(t) either side of $n \omega$. This is Amplitude Modulation (AM).  For example if $d(t)$ is a random variable with maximum frequency $\omega_m$ radians, we would see a uniform noise spectrum over the interval $n \omega \pm \omega_m$, with a central "carrier" spectral line at $n \omega$. If $\omega_m > \omega/2$, the entire region between each harmonic will have additive white noise generated from the PWM signal.

For larger $h$, Equation \ref{eq:pwm_n} can be interpreted as Phase Modulation (PM) \cite{wikipedia_phase} of a zero frequency carrier. Assuming a random $d(t)$, the resulting spectra of $x(t)$ can be approximated using Carsons Rule, as having 98\% of it's power contained within $B_c=2(h+1)f_m$ Hz, where $f_m$ is the maximum frequency component of $d(t)$. When multiplied by the $cos(n \omega t)$ term, the PM signal will spread the power of the carrier over range of adjacent frequencies, replacing the PWM carrier in the small $h$ case with a band of white noise.

For example, let $a=0.02$ (a few percent jitter of the PWM duty cycle) and the bandwidth of the PWM control loop be $f_m=3$ kHz. At $n=100$ we have $h=\pi n a = 2\pi$, which implies a random deviation of $\pm 2\pi$ (two cycles of $sin()$), and an $x(t)$ bandwidth of $B_c=2(2 \pi+1)f_m = (4\pi+2)f_m = 43$ kHz.

Given $h$ increases with $n$, we can expect to see AM type modulation either side of central harmonics lines at lower frequencies.  At intermediate frequencies a raised noise floor will be observed between harmonics.  As the frequency increases further the power of the harmonics lines will reduce and gradually be replaced by broadband noise.

\subsection{Further Work}

Figures illustrating effects above, perhaps an Octave simulation, showing small and large beta, sine wave and band pass white noise.

What would we expect to hear with a bandpass receiver (ie it's impact) with $\omega > B$?  I guess a band pass version of d(t), this may or may not be white.  If not white, it may have structure we can exploit. It may also be periodic, of quasi-stationary.

Attacks:
\begin{enumerate}
\item Estimation and subtraction of the signals. Key take away is mirror of signal about carrier. Estimation of signal from one sideband to cancel other.  Estimation of signal by AM demodulation (envelope). This will get awkward when it's spread so far that we get energy from n+1, n-1 near harmonic n.  However in that case it may not be as annoying/strong.

\item Estimation of signal from adjacent harmonics.  Can we find $x_n(t)$ from $x_{n-1}(t)$?  $\omega$ and $n$ can be estimated.  A direct form solution is unlikely however the equations are differentiable so an iterative solution could be found.

\item Dual channel coherent removal.

\item Noise blanking in the time domain.

\item Training of time domain pulses, correlation and removal.
\end{enumerate}

\section{Noise Blanker}

Consider a signal $x(t)$ consisting of a wanted signal $s(t)$, and an unwanted impulse train that repeats every $1/R$ seconds.
\begin{equation}
x(t) = a_1 e^{j \omega_1 t} + a_{imp}\sum_{n=-\infty}^{\infty}\delta(t-n/R)
\end{equation}
To remove the impulse, a blanking pulse train $b(t)$ is applied.  Each pulse is $T$ seconds wide:
\begin{equation}
\begin{split}
b(t) &= 1 - p(t) \\
p(t) &= \sum_{n=-\infty}^{\infty}rect(t-n) \\
rect(t) &= 
	\begin{cases}
      1, & |t| <= T/2 \\
      0, & otherwise \\
	\end{cases} \\
\sum_{n=-\infty}^{\infty}\delta(t-n/R) b(t) &= 0
\end{split}
\end{equation} 

\begin{figure}[h]
\caption{Blanking Pulse $b(t)$ }
\vspace{5mm}
\label{fig:rect_time}
\centering
\begin{tikzpicture}
\draw[thick,->] (1,0) -- (5,0) node [below]{t};
\draw (1,2) -- (2,2) -- (2,0) node [below]{$-T/2$} -- (4,0) node [below]{$T/2$} -- (4,2) -- (5,2);
\end{tikzpicture}
\end{figure}

The pulse train $p(t)$ can be expressed as Fourier Series (\ref{eq_pwm})
\begin{equation}
\begin{split}
p(t) &= d+\frac{2}{\pi} \sum_{n=1}^{\infty} \frac{sin(\pi n d)}{n}cos(n \alpha t) \\
     &= d + d \sum_{n=1}^{\infty} sinc(\pi n d) \left[ e^{-j\alpha n} + e^{j \alpha n} \right] \\
     &= d + d h(t) \\
h(t) &= \sum_{n=1}^{\infty} sinc(\pi n d) \left[ e^{-j\alpha n} + e^{j \alpha n} \right]  
\end{split}
\end{equation}
where $\alpha=2 \pi R$ is the angular frequency of the pulse train, $d=TR$ is the duty cycle, and $h(t)$ is the RHS term containing the harmonics.  The Fourier Transform of $h(t)$ is:
\begin{equation}
\begin{split}
H(w) &= \int_{-\infty}^{\infty}h(t)e^{-j \omega t}dt \\
     &= \int_{-\infty}^{\infty} \sum_{n=1}^{\infty} sinc(\pi n d) e^{-j\alpha n}e^{-j \omega t}dt \\
     &+ \int_{-\infty}^{\infty} \sum_{n=1}^{\infty} sinc(\pi n d) e^{j\alpha n}e^{-j \omega t}dt \\
     &= \sum_{n=1}^{\infty} sinc(\pi n d) \left[ \delta(\omega + \alpha n) + \delta(\omega - \alpha n) \right]
\end{split}
\end{equation}
The frequency shifted Fourier transform of $h(t)e^{j \omega_1 t}$ is
\begin{equation}
\begin{split}
\int_{-\infty}^{\infty} h(t)e^{j \omega_1 t} e^{-j \omega t}dt &= H(\omega-\omega_1) \\
  &= \sum_{n=1}^{\infty} sinc(\pi n d) \left[ \delta(\omega + \alpha n - \omega_1) + \delta(\omega - \alpha n - \omega_1) \right]
\end{split}
\end{equation}

Consider the output of the noise blanker:

\begin{equation}
\begin{split}
y(t) &= x(t)b(t) \\
     &= a_1 e^{j \omega_1 t} - a_1 e^{j \omega_1 t}p(t) \\
     &= a_1 e^{j \omega_1 t} - a_1 e^{j \omega_1 t}(d + dh(t)) \\    
     &= a_1 (1-d) e^{j \omega_1 t} - a_1 d h(t) e^{j \omega_1 t} \\    
Y(w) &= a_1 (1-d) \delta(\omega - \omega_1) - a_1 d H(\omega-\omega_1) \\
     &= a_1 (1-d) \delta(\omega - \omega_1) \\
     &- a_1 d \sum_{n=1}^{\infty} sinc(\pi n d) \left[ \delta(\omega + \alpha n - \omega_1) + \delta(\omega - \alpha n - \omega_1) \right]
\end{split}
\end{equation} 

Observations:
\begin{enumerate}
\item The wanted signal has been reduced to $(1-d)$, and harmonics $H(\omega)$ have been introduced either side.
\item The sideband level is proportional to the duty cycle $d$.
\item If the harmonic levels approach $a_1$ they may cause interference.  However for PSK waveforms a margin of a few dB beneath the wanted signal would be acceptable.  This suggests digital waveforms are more robust to noise blanking that analog. 
\item A second, strong signal in the pass band could introduce interference if one of it's harmonic sidebands approaches $a_1$ at $\omega_1$.  This is the intermodulation effect of noise blankers.
\item The analysis in Section \ref{pwm} showed that even small amounts of jitter can cause broadband noise.  This analysis suggests a narrow time domain blanking pulse $T<<1/R$ can remove that noise with a modest impact on the wanted signal. 
\item With noise/blanker pulse rates $R>B$, the harmonics are separated by $R$, so blanker harmonics are likely to be outside of our target pass band $B$.
\end{enumerate}

Octave plots for $R>B$ and $R<B$

\bibliographystyle{plain}
\bibliography{emi_refs}
\end{document}
