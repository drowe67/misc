\documentclass{article}
\usepackage{amsmath}
\usepackage{array}
\usepackage{siunitx}  
\begin{document}

\title{Low SNR FreeDV Mode}
\author{David Rowe VK5DGR}
\maketitle

\section{Glossary}

\begin{table}[h]
\centering
\begin{tabular}{l p{8cm} }
 \hline
 Acronym & Explanation \\
 \hline
 AWGN & Additive White Gaussian Noise - a communications channel with flat frequency response and additive noise \\
 FEC & Forward Error Correction \\
 PTT & Push To Talk - voice communications where only one person is transmitting at any one time.  Common in two way radio but not mobile telephones  \\
 MPP & Multipath Poor channel, 1 Hz Doppler, 2ms delay spread, typical for US and Australian interstate propogation \\
 MPD & Multipath Disturbed channel, 2 Hz Doppler, 4ms delay spread, typical for UK Winter NVIS propogation \\
 \hline
\end{tabular}
\caption{Glossary of Acronyms}
\end{table}

\begin{table}[h]
\centering
\begin{tabular}{l l l}
 \hline
 Symbol & Explanation & Units \\
 \hline
 $B$ & Noise bandwidth & Hz \\
 $E_b/N_0$ & Energy per bit on spectral noise density & dimensionless, dB\footnote{1} \\
 $N_p$ & Pilot symbol insertion rate & - \\
 $R_b$ & Bit rate & Bits/second \\
 $R_s$ & Symbol rate & symbols/second \\
 $T_s$ & Symbol period & seconds \\
 $SNR$ & Signal to Noise Ratio & dB \\
 $S$ & Signal Power & Watts \\
 $N$ & Noise Power & Watts \\
 \hline
\end{tabular}
\caption{Glossary of Symbols}
\end{table}

\footnotetext[1]{Can be expressed as a linear ratio $E_b/N_0$ or $10log_{10}(E_b/N_0)$ dB}

\section{Introduction}

After 10 years development and on air experience with various FreeDV waveforms, we would like to develop a new waveform that outperforms and replaces a variety of existing modes such as 700C/D/E and 1600.  Requirements include \cite{freedv-020}:
\begin{enumerate}
\item Better performance than SSB at 0dB SNR on MPP and MPD channels.
\item A single mode that can handle MPP and MPD, and replace several existing FreeDV modes, simplifying the end user experience.
\item For compliance with Export Control regulations, the minimum speech codec bit rate is 700 bit/s.
\end{enumerate}

\section{Theory}

In this section we will develop a theoretical model to help us explore performance limits.  For practical PTT voice systems algorithmic delay is limited to a few 100ms, which limits the FEC codeword size and hence the performance of the code.  For PSK channels a threshold $E_b/N_0=2 \, \si{dB}$ and a code rate $R=0.5$ is typical, where $E_b/N_0$ is the energy per payload data bit (coded $E_b/N_0$).  The lowest (threshold) SNR for a viable voice link is given by:
\begin{equation}
\label{eq:snr}
\begin{split}
\frac{S}{N} &= \frac{E_bR_b}{N_0B} \\
SNR &= 10log_{10}\left(\frac{E_b}{N_0}\right) + 10log_{10}\left(\frac{R_b}{B}\right) \quad [\si{dB}]
\end{split}
\end{equation}
where $R_b$ is the payload data bit rate, and $B$ is the bandwidth in which we measure SNR.  Given $Rb=700$ and $B=3000$ we have:
\begin{equation}
\begin{split}
SNR &= 2 + 10log_{10}(700/3000) \\
    &= -4.3 \, \si{dB}
\end{split}
\end{equation}
This is ideal performance for an AWGN channel.  In practice we must allocate some power to symbols used for synchronisation, such as pilot symbols used for frequency and phase estimation, or unique word bits used for frame synchronisation.  Synchronisation algorithms often struggle at low SNRs, introducing additional "implementation" losses.

Performance on multipath channels is significantly worse, in our use cases typically 5 dB.  On these channels, we may allocate some carrier power to deal with intersymbol interference (for example a cyclic prefix in OFDM modems).

A more complete model is:
\begin{equation}
\label{eq:snr_all}
SNR = 10log_{10}\left(\frac{E_b}{N_0}\right) + 10log_{10}\left(\frac{R_b}{B}\right) + L_s + L_{il} + L_{cp}
\end{equation}
where $L_s$ is the loss from power allocated to synchronisation symbols, $L_{il}$ is the real world implementation loss, and $L_{cp}$ is the loss in SNR due to the power allocated to the cyclic prefix.

\subsection{Pilot symbol overhead}

In this section we explore the effect of inserting pilot symbols on the threshold SNR (\ref{eq:snr}). Consider a sequence of $N_p-1$ PSK data symbols that carry the modulated FEC codeword bits (e.g. data and parity bits) over the channel. We denote this sequence a \emph{frame}. The frame of $N_p-1$ symbols has a period of $T_f=(N_p-1)T_s$ seconds, where $T_s$ is the period of each symbol.  We wish to insert a single pilot symbol after the data symbols, creating a new frame $N_p$ symbols long, with period $T^\prime_f=N_pT_s$.  To maintain the same payload data rate:
\begin{equation}
\begin{split}
T_f &= T^\prime_f \\
(N_p-1)T_s &= N_pT_s \\
R^\prime_s &= R_s\frac{N_p}{N_p-1}
\end{split}
\end{equation}
where the symbol rate $R_s=1/T_s$.  Expressing $S/N$ (\ref{eq:snr}) in terms of $E_s$ and $R_s$:
\begin{equation}
\label{eq_snr_s}
\begin{split}
\frac{S}{N} &= \frac{E_sR_s}{N_0B} \\
\frac{S}{N}^\prime &= \frac{E_sR^\prime_s}{N_0B} \\
                   &= \frac{E_bR_sN_p}{N_0B(N_p-1)} \\
\frac{S^\prime/N}{S/N} &= \frac{N_p}{N_p-1}
\end{split}
\end{equation}
Thus when we insert pilots, the threshold $S/N$ increases by a factor of $N_p/(N_p-1)$. Expressed in $\si{dB}$:
\begin{equation}
\begin{split}
10log_{10}\left(\frac{S^\prime}{N}\right) &= 10log_{10}\left(\frac{S}{N}\right) + 10log_{10}\left(\frac{N_p}{N_p-1}\right) \\
SNR^\prime &= SNR + 10log_{10}\left(\frac{N_p}{N_p-1}\right) \\
SNR^\prime &= SNR + L_p  \quad [\si{dB}]
\end{split}
\end{equation}
where $L_p$ can be considered the pilot symbol \emph{loss} - the SNR degradation from the ideal performance (\ref{eq:snr}) due to the insertion of pilot symbols. For example a pilot insertion rate of $N_p=8$ results in $L_p=10log_{10}(8/7)=0.58 \, \si{dB}$, thus we need 0.58 dB more SNR to acheive the threshold SNR for the voice link.  If there is no other synchronisation overhead, then $L_s=L_p$ in Equation \ref{eq:snr_all}.

\subsection{Cyclic Prefix Overhead}

Now we consider the SNR overhead for the Cycle Prefix (CP) used in OFDM modems to cope with delay spread on multipath channels.  To achieve our payload data rate (e.g. 700 bits/s), we send symbols $D$ across the channel at a constant symbol rate $R_s$, or one symbol every $T=T_s$ seconds.  To cope with delay spread, we construct a composite symbol by pre-pending a Cyclic Prefix (CP) $T_{cp}$ seconds in duration to a new symbol $D^\prime$ of $T^\prime_s$ seconds in duration.  $D$ and $D^\prime$ contain the same PSK symbol, and convey the same information over the channel. The new composite symbol is now $T^\prime = T_{cp}+T^\prime_s$ seconds long.  The CP contains no additional information, it is just an extension of the single symbol $D^\prime$. Thus we still send one symbol of data over the channel every $T^\prime$ seconds.  To maintain the payload data rate over the channel, we must send the new composite symbol at the same rate as the original symbol:
\begin{equation}
\begin{split}
T &= T^\prime \\
T_s &= T_{cp} + T^\prime_s \\
R^\prime_s &= \frac{R_s}{1 - T_{cp}/T_s}
\end{split}
\end{equation}
It can be observed that $R^\prime_s > R_s$, to account for the portion of the composite symbol allocated to the CP.  For example with $R_s=700$, $T_s=0.02$, $T_{cp}=0.002$, $R^\prime_s=700/(1-0.002/0.02)=777.78$ symbols/second.

For the composite signal, the transmitter power $S$ is spread between the CP and $D^\prime$: 
\begin{equation}
S = \frac{T_{cp}}{T_s}S + \left(1 - \frac{T_{cp}}{T_s} \right)S
\end{equation}
Only the RH term contributes to the demodulation of $D^\prime$:
\begin{equation}
\begin{split}
\frac{S(1-T_{cp}/T_s)}{N} &= \frac{E_sR^\prime_s}{N_0B} \\
\frac{S}{N} &= \frac{E_sR^\prime_s}{N_0B}\frac{1}{(1-T_{cp}/T_s)}\\
            &= \frac{E_sR_s}{N_0B}\frac{1}{(1-T_{cp}/T_s)^2} \\
\end{split}
\end{equation}
Thus to close the link with the composite symbol the $S/N$ must be increased by a factor of $1/(1 - {T_s}/T_{cp})^2$ compared to our ideal modem.  This accounts for the energy allocated to the CP, and the shorter period $T^\prime_s$ of the symbol $D^\prime$.

\section{Unorganised Notes}

TODO:

\begin{itemize}
\item Challenges, fast fading, ISI, PAPR
\item Expression for Fading channels, block error rate.
\item Table of FreeDV waveforms and values, plugged into formula, effect of increasing pilot symbol rate.
\item Check performance of a few codes again 2dB figure above.
\item Where we can gain, diversity, PAPR reduction, reduced overheads for fast fading and ISI (discuss)
\item single tone/equaliser
\item Joint low latency/high latency on two carriers diversity
\item Wades techniques (ref)
\end{itemize} 

\bibliographystyle{plain}
\bibliography{freedv_low_refs}
\end{document}
